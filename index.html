<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë©´ì ‘ Kongdinator</title>
    <style>
        :root { --primary: #4a90e2; --sub: #f1f3f5; --accent: #28a745; --text: #333; }
        body { font-family: 'Pretendard', -apple-system, sans-serif; background: #f5f7fa; padding: 20px; display: flex; justify-content: center; margin: 0; }
        .container { background: white; padding: 30px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); width: 100%; max-width: 450px; }
        
        h2 { text-align: center; color: var(--text); margin-bottom: 5px; font-weight: 800; }
        .guide { text-align: center; font-size: 0.85rem; color: #777; margin-bottom: 25px; line-height: 1.5; }

        /* í™”ì‚´í‘œ ë„¤ë¹„ê²Œì´ì…˜ ë‹¬ë ¥ í—¤ë” */
        .calendar-nav { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding: 0 10px; }
        .nav-btn { background: none; border: 1px solid #ddd; border-radius: 50%; width: 32px; height: 32px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: 0.2s; color: #555; font-weight: bold; }
        .nav-btn:hover { background: var(--primary); color: white; border-color: var(--primary); }
        .nav-btn:disabled { opacity: 0.2; cursor: not-allowed; }
        #month-display { font-size: 1.15rem; font-weight: 700; color: var(--primary); min-width: 120px; text-align: center; }

        /* í‰ì¼ ë‹¬ë ¥ ê·¸ë¦¬ë“œ (5ì—´) */
        .calendar-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; margin-bottom: 30px; }
        .day { padding: 12px 0; text-align: center; border: 1px solid #f0f0f0; border-radius: 10px; cursor: pointer; font-size: 0.9rem; transition: 0.2s; background: #fff; color: #444; }
        .day:hover { background: #eef5ff; color: var(--primary); font-weight: bold; transform: translateY(-2px); }
        .day.selected { background: var(--primary); color: white; border-color: var(--primary); font-weight: bold; }
        .day.label { border: none; font-weight: 700; color: #bbb; cursor: default; font-size: 0.75rem; text-align: center; }
        .day.empty { border: none; cursor: default; visibility: hidden; }

        /* ì§€ë§ ë°•ìŠ¤ ìŠ¤íƒ€ì¼ */
        .choice-box { background: var(--sub); padding: 20px; border-radius: 15px; margin-bottom: 15px; border: 1px solid #eceef0; }
        .choice-title { font-weight: bold; margin-bottom: 12px; display: flex; justify-content: space-between; align-items: center; }
        .choice-title span { color: var(--primary); font-size: 0.9rem; letter-spacing: -0.5px; }
        .choice-title small { cursor: pointer; color: #999; font-weight: normal; font-size: 0.75rem; background: #fff; padding: 2px 8px; border-radius: 10px; border: 1px solid #ddd; }
        
        .selected-date-display { font-size: 1.1rem; color: #212529; margin-bottom: 15px; font-weight: 700; }
        
        .time-group { display: flex; gap: 8px; flex-wrap: wrap; }
        .time-group label { background: white; border: 1px solid #dee2e6; padding: 8px 14px; border-radius: 8px; font-size: 0.85rem; cursor: pointer; transition: 0.2s; font-weight: 500; }
        .time-group input { display: none; }
        .time-group input:checked + label { background: var(--accent); color: white; border-color: var(--accent); box-shadow: 0 4px 10px rgba(40, 167, 69, 0.2); }

        .user-info { margin-top: 30px; }
        input[type="text"] { width: 100%; padding: 15px; border: 1px solid #ddd; border-radius: 12px; box-sizing: border-box; font-size: 1rem; outline: none; transition: 0.2s; }
        input[type="text"]:focus { border-color: var(--primary); box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.1); }
        
        #submit-btn { width: 100%; padding: 18px; background: var(--primary); color: white; border: none; border-radius: 12px; font-weight: bold; margin-top: 20px; cursor: pointer; font-size: 1rem; transition: 0.3s; }
        #submit-btn:hover { background: #357abd; transform: translateY(-2px); box-shadow: 0 5px 15px rgba(74, 144, 226, 0.3); }
        #submit-btn:disabled { background: #ccc; cursor: not-allowed; transform: none; box-shadow: none; }
    </style>
</head>
<body>

<div class="container">
    <h2>ğŸ“… ì½© ë©´ì ‘ì¼ì • ì¡ê¸° </h2>
    <p class="guide">ë©´ì ‘ í¬ë§ ë‚ ì§œë¥¼ ìˆœì„œëŒ€ë¡œ ì„ íƒí•´ ì£¼ì„¸ìš” (3ê°œ).<br></p>

    <div class="calendar-nav">
        <button type="button" class="nav-btn" id="prevMonth">&lt;</button>
        <div id="month-display">2026ë…„ 1ì›”</div>
        <button type="button" class="nav-btn" id="nextMonth">&gt;</button>
    </div>

    <div class="calendar-grid" id="calendar-days">
        <div class="day label">ì›”</div><div class="day label">í™”</div><div class="day label">ìˆ˜</div>
        <div class="day label">ëª©</div><div class="day label">ê¸ˆ</div>
        </div>

    <form id="survey-form">
        <div id="choices-container"></div>

        <div class="user-info">
            <input type="text" name="user_name" placeholder="ì§€ì›ì ì„±í•¨" required>
        </div>

        <button type="submit" id="submit-btn">ë©´ì ‘ ì¼ì • ì œì¶œí•˜ê¸°</button>
    </form>
</div>

<script>
    // â˜…â˜…â˜… ì—¬ê¸°ì— ë³¸ì¸ì˜ êµ¬ê¸€ ì›¹ ì•± URLì„ ë¶™ì—¬ë„£ìœ¼ì„¸ìš” â˜…â˜…â˜…
    const scriptURL = 'https://script.google.com/macros/s/AKfycbx4TEm1bRi1m21ORMOWZNNh6K-eB_PfTrk8iPWSJhLYDsadusW_Yj0d1iY7EGwjiyLHow/exec';
    
    const year = 2026;
    let currentMonth = 0; // 0 = 1ì›”
    let choices = [null, null, null];

    // ì§€ë§ ì„¹ì…˜ ë™ì  ìƒì„±
    const choicesContainer = document.getElementById('choices-container');
    for (let i = 1; i <= 3; i++) {
        choicesContainer.innerHTML += `
            <div class="choice-box">
                <div class="choice-title"><span>${i}ì§€ë§ ì„ íƒ</span> <small onclick="resetChoice(${i-1})">ì´ˆê¸°í™”</small></div>
                <div class="selected-date-display" id="date-text-${i}">ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”</div>
                <input type="hidden" name="date${i}" id="hidden-date-${i}">
                <div class="time-group">
                    ${['14:00', '15:00', '16:00', '17:00'].map(t => `
                        <input type="checkbox" name="time${i}" value="${t}" id="t${i}-${t}">
                        <label for="t${i}-${t}">${t}</label>
                    `).join('')}
                </div>
            </div>
        `;
    }

    function renderCalendar() {
        const grid = document.getElementById('calendar-days');
        const display = document.getElementById('month-display');
        const labels = grid.querySelectorAll('.label');
        
        display.innerText = `${year}ë…„ ${currentMonth + 1}ì›”`;
        grid.innerHTML = '';
        labels.forEach(l => grid.appendChild(l));

        const firstDate = new Date(year, currentMonth, 1);
        const lastDate = new Date(year, currentMonth + 1, 0).getDate();
        
        // ì›”ìš”ì¼(1) ê¸°ì¤€ ì˜¤í”„ì…‹ (í‰ì¼ 5ì¼ ê·¸ë¦¬ë“œìš©)
        let firstDay = firstDate.getDay(); 
        let offset = firstDay === 0 ? 0 : firstDay - 1; 
        if (firstDay === 0 || firstDay === 6) offset = 0; 

        for (let i = 0; i < offset && i < 5; i++) {
            const div = document.createElement('div');
            div.classList.add('day', 'empty');
            grid.appendChild(div);
        }

        for (let d = 1; d <= lastDate; d++) {
            const dateObj = new Date(year, currentMonth, d);
            const dayOfWeek = dateObj.getDay();

            if (dayOfWeek !== 0 && dayOfWeek !== 6) {
                const dateDiv = document.createElement('div');
                dateDiv.classList.add('day');
                dateDiv.innerText = d;
                const dateKey = `${currentMonth + 1}ì›” ${d}ì¼`;
                if (choices.includes(dateKey)) dateDiv.classList.add('selected');
                dateDiv.onclick = () => selectDate(d);
                grid.appendChild(dateDiv);
            }
        }

        // ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼ í™œì„±/ë¹„í™œì„± (2026ë…„ ì œí•œ)
        document.getElementById('prevMonth').disabled = (currentMonth === 0);
        document.getElementById('nextMonth').disabled = (currentMonth === 11);
    }

    function selectDate(day) {
        const dateStr = `${currentMonth + 1}ì›” ${day}ì¼`;
        if (choices.includes(dateStr)) return;
        
        const emptyIdx = choices.findIndex(c => c === null);
        if (emptyIdx === -1) { alert("3ì§€ë§ê¹Œì§€ ëª¨ë‘ ì„ íƒë˜ì—ˆìŠµë‹ˆë‹¤."); return; }

        choices[emptyIdx] = dateStr;
        document.getElementById(`date-text-${emptyIdx + 1}`).innerText = `2026ë…„ ${dateStr}`;
        document.getElementById(`hidden-date-${emptyIdx + 1}`).value = `2026ë…„ ${dateStr}`;
        renderCalendar();
    }

    window.resetChoice = function(idx) {
        choices[idx] = null;
        document.getElementById(`date-text-${idx + 1}`).innerText = "ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”";
        document.getElementById(`hidden-date-${idx + 1}`).value = "";
        renderCalendar();
    }

    document.getElementById('prevMonth').onclick = () => { if(currentMonth > 0) { currentMonth--; renderCalendar(); } };
    document.getElementById('nextMonth').onclick = () => { if(currentMonth < 11) { currentMonth++; renderCalendar(); } };

    document.getElementById('survey-form').onsubmit = async (e) => {
        e.preventDefault();
        if (choices.includes(null)) { alert("3ì§€ë§ê¹Œì§€ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”."); return; }

        const btn = document.getElementById('submit-btn');
        btn.disabled = true; btn.innerText = "ì œì¶œ ì¤‘...";

        const formData = new FormData(e.target);
        const params = new URLSearchParams();
        params.append("user_name", formData.get("user_name"));
        [1,2,3].forEach(i => {
            params.append(`date${i}`, formData.get(`date${i}`));
            params.append(`time${i}`, formData.getAll(`time${i}`).join(", "));
        });

        try {
            await fetch(scriptURL, { method: 'POST', body: params });
            alert("ë©´ì ‘ ì‹ ì²­ì´ ì •ìƒì ìœ¼ë¡œ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤.");
            location.reload();
        } catch (err) {
            alert("ì œì¶œ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
            btn.disabled = false; btn.innerText = "ë©´ì ‘ ì¼ì • ì œì¶œí•˜ê¸°";
        }
    };

    renderCalendar();
</script>

</body>
</html>
